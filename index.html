<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Solar System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar-nft.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 9999;
        }
        
        #loading.hidden {
            display: none;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #instructions {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 1000;
            text-align: center;
            max-width: 80%;
        }
        
        #status {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 1000;
            font-size: 14px;
        }
        
        .status-active {
            background: rgba(0, 150, 0, 0.8) !important;
        }
    </style>
</head>
<body>
    <div id="loading">
        <div class="spinner"></div>
        <p>A carregar experi√™ncia AR...</p>
        <p style="font-size: 12px;">Por favor, permita o acesso √† c√¢mara</p>
    </div>
    
    <div id="instructions">
        üì± Aponte a c√¢mara para a imagem "solar.jpg"
    </div>
    
    <div id="status">Procurando marcador...</div>

    <!-- Cena A-Frame com AR.js -->
    <a-scene
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3; sourceWidth: 1280; sourceHeight: 960; displayWidth: 1280; displayHeight: 960; videoTexture: true;"
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; precision: medium; antialias: true; alpha: true;"
        loading-screen="enabled: false">
        
        <!-- Assets -->
        <a-assets>
            <!-- Modelo 3D -->
            <a-asset-item id="solarModel" src="solar.glb"></a-asset-item>
            
            <!-- Marcador de imagem -->
            <img id="solarMarker" src="solar.jpg" crossorigin="anonymous">
        </a-assets>
        
        <!-- Marcador AR baseado em imagem -->
        <a-marker
            type="pattern"
            preset="custom"
            url="solar.patt"
            smooth="true"
            smoothCount="10"
            smoothTolerance="0.01"
            smoothThreshold="5"
            raycaster="objects: .clickable"
            emitevents="true"
            cursor="fuse: false; rayOrigin: mouse;"
            id="markerA">
            
            <!-- Grupo principal do modelo -->
            <a-entity id="model-container" position="0 0 0" rotation="0 0 0" scale="1 1 1">
                <!-- Modelo 3D -->
                <a-entity
                    gltf-model="#solarModel"
                    position="0 0 0"
                    rotation="-90 0 0"
                    scale="1 1 1"
                    animation-mixer="clip: *; loop: repeat; repetitions: Infinity"
                    shadow="cast: true; receive: true">
                </a-entity>
                
                <!-- Ilumina√ß√£o ambiente -->
                <a-entity light="type: ambient; color: #BBB; intensity: 0.8"></a-entity>
                
                <!-- Luz direcional principal -->
                <a-entity light="type: directional; color: #FFF; intensity: 1.2; castShadow: true" 
                          position="2 4 2"></a-entity>
                
                <!-- Luz de preenchimento -->
                <a-entity light="type: point; color: #FFF; intensity: 0.5; distance: 10; decay: 2" 
                          position="-2 2 2"></a-entity>
                
                <!-- Luz traseira suave -->
                <a-entity light="type: point; color: #88CCFF; intensity: 0.3; distance: 10" 
                          position="0 2 -2"></a-entity>
            </a-entity>
        </a-marker>

        <!-- C√¢mara -->
        <a-entity camera 
                  look-controls="enabled: false"
                  zoom="1"
                  fov="80"></a-entity>
    </a-scene>

    <script>
        // Gest√£o da interface
        const loadingEl = document.getElementById('loading');
        const statusEl = document.getElementById('status');
        const instructionsEl = document.getElementById('instructions');
        
        // Ocultar loading ap√≥s inicializa√ß√£o
        setTimeout(() => {
            loadingEl.classList.add('hidden');
        }, 2000);
        
        // Criar padr√£o de marcador personalizado (fallback)
        // Nota: Em produ√ß√£o, voc√™ deve gerar um arquivo .patt usando ferramentas como AR.js Marker Training
        // Para este exemplo, vamos usar detec√ß√£o por barcode como alternativa
        
        // Evento quando o marcador √© encontrado
        const marker = document.querySelector('#markerA');
        let markerFound = false;
        
        if (marker) {
            marker.addEventListener('markerFound', () => {
                markerFound = true;
                statusEl.textContent = '‚úì Marcador detetado!';
                statusEl.classList.add('status-active');
                instructionsEl.style.display = 'none';
                
                // Adicionar anima√ß√£o de entrada suave
                const modelContainer = document.getElementById('model-container');
                if (modelContainer) {
                    modelContainer.setAttribute('animation', {
                        property: 'scale',
                        from: '0.1 0.1 0.1',
                        to: '1 1 1',
                        dur: 800,
                        easing: 'easeOutElastic'
                    });
                }
            });
            
            marker.addEventListener('markerLost', () => {
                markerFound = false;
                statusEl.textContent = 'Procurando marcador...';
                statusEl.classList.remove('status-active');
                instructionsEl.style.display = 'block';
            });
        }
        
        // Configura√ß√£o alternativa usando barcode (se o padr√£o n√£o funcionar)
        // Substitua o a-marker acima por:
        // <a-marker type="barcode" value="6">
        
        // Log de debug
        console.log('AR.js inicializado');
        console.log('Procure pelo marcador solar.jpg ou use um QR code como alternativa');
        
        // Verificar permiss√µes de c√¢mara
        navigator.mediaDevices.getUserMedia({ 
            video: { 
                facingMode: 'environment',
                width: { ideal: 1280 },
                height: { ideal: 960 }
            } 
        })
            .then(stream => {
                console.log('C√¢mara autorizada');
                stream.getTracks().forEach(track => track.stop());
            })
            .catch(err => {
                console.error('Erro ao aceder √† c√¢mara:', err);
                statusEl.textContent = '‚ùå Erro: Permita o acesso √† c√¢mara';
                statusEl.style.background = 'rgba(150, 0, 0, 0.8)';
            });
    </script>
</body>
</html>
